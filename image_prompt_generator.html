<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</title>
    
    <!-- CSS íŒŒì¼ ë§í¬ -->
    <link rel="stylesheet" href="design-system.css">
    <link rel="stylesheet" href="concept-art-styles-modern.css">
    <link rel="stylesheet" href="concept-art-styles-unified.css">
    
    <!-- SEO -->
    <meta name="description" content="AI ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì œì‘ ë„êµ¬">
    <meta name="keywords" content="AI ì´ë¯¸ì§€ìƒì„±, í”„ë¡¬í”„íŠ¸, Midjourney, DALL-E, Stable Diffusion">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¼ï¸</text></svg>">
    
    <style>
        /* í˜ì´ì§€ íŠ¹í™” ìŠ¤íƒ€ì¼ */
        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: var(--space-lg);
            padding-top: 80px;
            position: relative;
            z-index: 1;
        }
        
        /* PCì—ì„œ ì ì ˆí•œ ì»¨í…ì¸  ë„ˆë¹„ ìœ ì§€ */
        @media (min-width: 1200px) {
            .main-container {
                padding-left: 3%;
                padding-right: 3%;
            }
        }

        .section {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            opacity: 0.8;
        }

        .section-header {
            margin-bottom: var(--space-sm);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .section-header-left {
            flex: 1;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .input-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }
        
        /* í° í™”ë©´ì—ì„œ ìµœì  ë¹„ìœ¨ */
        @media (min-width: 1400px) {
            .input-area {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-lg);
            }
        }
        
        /* ì´ˆëŒ€í˜• í™”ë©´ì—ì„œ ë” ë„“ì€ ë ˆì´ì•„ì›ƒ */
        @media (min-width: 1600px) {
            .input-area {
                grid-template-columns: 1.2fr 0.8fr;
                gap: var(--space-xl);
            }
        }

        .input-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            transition: all var(--transition-base);
        }

        .input-section:hover {
            border-color: rgba(168, 85, 247, 0.5);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.1);
        }

        .input-section h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
            word-break: keep-all;
            white-space: normal;
        }

        .text-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 150px;
            transition: all var(--transition-base);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .file-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .file-upload-area:hover {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.05);
        }

        .file-upload-area.drag-over {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
            opacity: 0.7;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
            font-size: 0.85rem;
        }

        .upload-hint {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .file-input {
            display: none;
        }

        /* ì´ë¯¸ì§€ í”„ë¦¬ë·° */
        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: var(--radius-sm);
            margin-top: var(--space-sm);
        }

        .remove-image-btn {
            position: absolute;
            top: var(--space-xs);
            right: var(--space-xs);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all var(--transition-base);
        }

        .remove-image-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 16px;
            border: none;
            border-radius: var(--radius-full);
            font-family: 'Paperlogy', sans-serif;
            font-weight: 500;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-export {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        /* ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ ì˜ì—­ */
        .output-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            margin-top: var(--space-md);
            display: none;
        }

        .output-section.active {
            display: block;
        }

        .output-text {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            color: var(--text-primary);
            font-family: 'Paperlogy', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .copy-btn {
            margin-top: var(--space-sm);
            background: var(--secondary-gradient);
            color: white;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* í”„ë¡¬í”„íŠ¸ ë³´ê¸° ì˜ì—­ */
        .prompt-preview-section {
            margin-top: var(--space-lg);
            margin-bottom: var(--space-md);
        }

        .preview-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .prompt-preview {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            min-height: 80px;
            font-family: 'Paperlogy', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text-primary);
            transition: all var(--transition-base);
        }

        .prompt-preview:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }

        .preview-placeholder {
            color: var(--text-tertiary);
            font-style: italic;
            margin: 0;
        }

        .prompt-preview.has-content {
            color: var(--text-primary);
            font-style: normal;
        }

        /* êµ¬ì¡°ë³„ ì¹´ë“œ ì„¹ì…˜ */
        .prompt-cards-section {
            margin-top: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .cards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .cards-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            word-break: keep-all;
            white-space: normal;
        }

        .btn-import {
            background: var(--secondary-gradient);
            color: white;
            font-size: 0.8rem;
            padding: 6px 14px;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .prompt-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-sm);
        }
        
        /* í° í™”ë©´ì—ì„œ ë” ë§ì€ ì¹´ë“œ í‘œì‹œ */
        @media (min-width: 1600px) {
            .prompt-cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: var(--space-md);
            }
        }

        .prompt-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            transition: all var(--transition-base);
            position: relative;
        }

        .prompt-card:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-1px);
        }

        .prompt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }

        .prompt-card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .prompt-card-edit-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            transition: all var(--transition-base);
        }

        .prompt-card-edit-btn:hover {
            color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.1);
        }

        .prompt-card-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
            min-height: 40px;
        }

        .prompt-card-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-xs);
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.8rem;
            resize: vertical;
            min-height: 60px;
            display: none;
        }

        .prompt-card.editing .prompt-card-content {
            display: none;
        }

        .prompt-card.editing .prompt-card-input {
            display: block;
        }

        .prompt-card-actions {
            display: none;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
        }

        .prompt-card.editing .prompt-card-actions {
            display: flex;
        }

        .prompt-card-btn {
            padding: 4px 12px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .prompt-card-save {
            background: var(--accent-green);
            color: white;
        }

        .prompt-card-save:hover {
            background: rgba(16, 185, 129, 0.8);
        }

        .prompt-card-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .prompt-card-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            bottom: var(--space-md);
            right: var(--space-md);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-weight: 500;
            font-size: 0.85rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-base);
            pointer-events: none;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* íƒœë¸”ë¦¿ ë””ìì¸ (768px - 1199px) */
        @media (min-width: 768px) and (max-width: 1199px) {
            .main-container {
                padding-left: var(--space-md);
                padding-right: var(--space-md);
            }
        }

        /* ëª¨ë°”ì¼ ë””ìì¸ */
        @media (max-width: 767px) {
            .input-area {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }

            .button-group {
                justify-content: center;
                gap: 8px;
                flex-wrap: wrap;
            }

            .main-container {
                padding: var(--space-sm);
                padding-top: 70px;
                max-width: 100%;
            }
            
            .section {
                padding: var(--space-sm);
                margin-bottom: var(--space-sm);
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .section-header-left {
                width: 100%;
            }
            
            .section-title {
                font-size: 1rem;
                word-break: keep-all;
                white-space: normal;
            }
            
            .section-subtitle {
                font-size: 0.75rem;
                word-break: keep-all;
                white-space: normal;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
                white-space: nowrap;
                min-width: auto;
            }
            
            .btn-ai-connect {
                width: 100%;
                justify-content: center;
            }
            
            .text-input {
                min-height: 120px;
                font-size: 0.8rem;
                word-break: break-word;
            }
            
            .file-upload-area {
                min-height: 120px;
                padding: var(--space-sm);
            }
            
            .upload-icon {
                font-size: 1.5rem;
            }
            
            .upload-text {
                font-size: 0.8rem;
                word-break: keep-all;
            }
            
            .upload-hint {
                font-size: 0.7rem;
                word-break: keep-all;
            }
            
            .prompt-preview-section {
                margin-top: var(--space-md);
                margin-bottom: var(--space-sm);
            }
            
            .prompt-preview {
                min-height: 60px;
                padding: var(--space-sm);
                font-size: 0.8rem;
                word-break: break-word;
                white-space: pre-wrap;
            }
            
            .preview-title {
                font-size: 0.85rem;
                word-break: keep-all;
            }
            
            .preview-placeholder {
                word-break: keep-all;
                white-space: normal;
            }
            
            .prompt-cards-grid {
                grid-template-columns: 1fr;
            }
            
            .prompt-card {
                padding: var(--space-xs);
            }
            
            .prompt-card-title {
                font-size: 0.8rem;
                word-break: keep-all;
            }
            
            .prompt-card-content {
                font-size: 0.75rem;
                word-break: break-word;
            }
            
            .cards-title {
                word-break: keep-all;
                white-space: normal;
                font-size: 0.8rem;
            }
            
            .cards-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-xs);
            }
            
            .btn-import {
                width: 100%;
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* ì´ˆì†Œí˜• ëª¨ë°”ì¼ (max-width: 380px) */
        @media (max-width: 380px) {
            .button-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Gradient Mesh Background -->
    <div class="gradient-mesh-bg"></div>
    
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="index.html" class="home-btn">ğŸ  í™ˆ</a>
                <h2 class="header-title" style="font-size: 1.1rem;">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</h2>
            </div>
            <div class="header-right">
                <div class="header-buttons">
                    <a href="storyboard/index.html" class="header-btn">ìŠ¤í† ë¦¬ë³´ë“œ</a>
                    <a href="your_title_storyboard_v9.4_c.html" class="header-btn">ì»¨ì…‰ì•„íŠ¸</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- ìš”ì²­ì‚¬í•­ ì…ë ¥ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-header">
                <div class="section-header-left">
                    <h2 class="section-title">ìš”ì²­ì‚¬í•­ ì…ë ¥</h2>
                    <p class="section-subtitle">2ê°€ì§€(í…ìŠ¤íŠ¸/ì´ë¯¸ì§€) ëª¨ë‘ ì‘ì„± ê°€ëŠ¥</p>
                </div>
                <button class="btn btn-primary btn-ai-connect" id="ai-connect-btn">
                    ğŸ¤– AI ì—°ë™
                </button>
            </div>

            <div class="input-area">
                <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ -->
                <div class="input-section">
                    <h3>í…ìŠ¤íŠ¸ ì…ë ¥ì°½</h3>
                    <textarea 
                        id="text-input" 
                        class="text-input" 
                        placeholder="ìƒì„±í•˜ê³  ì‹¶ì€ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    ></textarea>
                </div>

                <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="input-section">
                    <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <div class="file-upload-area" id="file-upload-area">
                        <input type="file" id="file-input" class="file-input" accept=".jpg,.jpeg,.png,.gif" />
                        <div class="upload-icon">ğŸ“¸</div>
                        <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                        <div class="upload-hint">JPG, PNG, GIF í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</div>
                    </div>
                </div>
            </div>

            <!-- í”„ë¡¬í”„íŠ¸ ë³´ê¸° ì˜ì—­ -->
            <div class="prompt-preview-section">
                <h3 class="preview-title">í”„ë¡¬í”„íŠ¸ ë³´ê¸°</h3>
                <div class="prompt-preview" id="prompt-preview">
                    <p class="preview-placeholder">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- êµ¬ì¡°ë³„ ì¹´ë“œ ì„¹ì…˜ -->
            <div class="prompt-cards-section" id="prompt-cards-section">
                <div class="cards-header">
                    <h3 class="cards-title">ğŸ¯ í”„ë¡¬í”„íŠ¸ êµ¬ì¡° í¸ì§‘ê¸°</h3>
                    <button class="btn btn-import" id="import-prompt-btn" onclick="importPromptFromPreview()">
                        ğŸ“¥ ê°€ì ¸ì˜¤ê¸°
                    </button>
                </div>
                <div class="prompt-cards-grid" id="prompt-cards-grid">
                    <!-- ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="button-group">
                <button class="btn btn-primary" id="generate-prompt-btn">
                    âœ¨ í”„ë¡¬í”„íŠ¸ ìƒì„±
                </button>
            </div>
        </div>

        <!-- ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ ì¶œë ¥ ì„¹ì…˜ -->
        <div class="section output-section" id="output-section">
            <div class="section-header">
                <h2 class="section-title">ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</h2>
            </div>
            <div class="output-text" id="output-text"></div>
            <button class="btn copy-btn" id="copy-prompt-btn">
                ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬
            </button>
        </div>
    </div>

    <!-- Toast Message -->
    <div id="toast" class="toast"></div>

    <script>
        // ë°ì´í„° ì €ì¥ìš© ê°ì²´
        let promptData = {
            textInput: '',
            imageFile: null,
            imagePreview: null,
            generatedPrompts: [],
            structuredPrompt: {}
        };

        // DOM ìš”ì†Œë“¤
        const textInput = document.getElementById('text-input');
        const fileInput = document.getElementById('file-input');
        const fileUploadArea = document.getElementById('file-upload-area');
        const generateBtn = document.getElementById('generate-prompt-btn');
        const outputSection = document.getElementById('output-section');
        const outputText = document.getElementById('output-text');
        const copyPromptBtn = document.getElementById('copy-prompt-btn');
        const toast = document.getElementById('toast');
        const aiConnectBtn = document.querySelector('.btn-ai-connect');
        const promptPreview = document.getElementById('prompt-preview');
        const promptCardsSection = document.getElementById('prompt-cards-section');
        const promptCardsGrid = document.getElementById('prompt-cards-grid');

        // íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸
        fileUploadArea.addEventListener('click', (e) => {
            if (!e.target.classList.contains('remove-image-btn')) {
                fileInput.click();
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('drag-over');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('drag-over');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
        function handleFileSelect(file) {
            // íŒŒì¼ íƒ€ì… ê²€ì¦
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showToast('JPG, PNG, GIF í˜•ì‹ì˜ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // íŒŒì¼ ì½ê¸°
            const reader = new FileReader();
            reader.onload = (e) => {
                promptData.imageFile = file;
                promptData.imagePreview = e.target.result;
                displayImagePreview(e.target.result);
                updatePromptPreview();
            };
            reader.readAsDataURL(file);
        }

        // ì´ë¯¸ì§€ í”„ë¦¬ë·° í‘œì‹œ
        function displayImagePreview(src) {
            fileUploadArea.innerHTML = `
                <button class="remove-image-btn" onclick="removeImage()">Ã—</button>
                <img src="${src}" alt="ì—…ë¡œë“œëœ ì´ë¯¸ì§€" class="image-preview">
            `;
        }

        // ì´ë¯¸ì§€ ì œê±°
        function removeImage() {
            promptData.imageFile = null;
            promptData.imagePreview = null;
            fileInput.value = '';
            
            fileUploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                <div class="upload-hint">JPG, PNG, GIF í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</div>
            `;
            
            updatePromptPreview();
        }

        // í”„ë¡¬í”„íŠ¸ ìƒì„±
        generateBtn.addEventListener('click', () => {
            const text = textInput.value.trim();
            
            if (!text && !promptData.imageFile) {
                showToast('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ê°„ë‹¨í•œ í”„ë¡¬í”„íŠ¸ ìƒì„± ë¡œì§ (ì‹¤ì œë¡œëŠ” AI API ì—°ë™)
            let prompt = '';
            
            if (text) {
                // í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ í–¥ìƒ
                prompt = enhancePrompt(text);
            }
            
            if (promptData.imageFile) {
                if (prompt) {
                    prompt += '\n\n[ì´ë¯¸ì§€ ì°¸ì¡° í¬í•¨]\n';
                }
                prompt += 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤íƒ€ì¼ê³¼ êµ¬ì„±';
            }

            // í”„ë¡¬í”„íŠ¸ ì €ì¥ ë° í‘œì‹œ
            promptData.generatedPrompts.push({
                timestamp: new Date().toISOString(),
                input: text,
                hasImage: !!promptData.imageFile,
                output: prompt
            });

            displayPrompt(prompt);
            saveToLocalStorage();
        });

        // í”„ë¡¬í”„íŠ¸ íŒŒì‹± í•¨ìˆ˜
        function parsePrompt(text) {
            const structure = {};
            
            // ë¨¼ì € ì „ì²´ í…ìŠ¤íŠ¸ì—ì„œ ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œ
            const params = [];
            const paramPattern = /--\w+\s+[^\s]+/g;
            let match;
            while ((match = paramPattern.exec(text)) !== null) {
                params.push(match[0]);
            }
            
            // íŒŒë¼ë¯¸í„°ë¥¼ í…ìŠ¤íŠ¸ì—ì„œ ì œê±°
            let cleanText = text;
            params.forEach(param => {
                cleanText = cleanText.replace(param, '');
            });
            
            // íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ PARAMETERSì— ì €ì¥
            if (params.length > 0) {
                structure['PARAMETERS'] = params.join(' ');
            }
            
            // ì„¸ë¯¸ì½œë¡ ìœ¼ë¡œ ë¶„ë¦¬
            const lines = cleanText.split(';').map(line => line.trim()).filter(line => line);
            
            lines.forEach(line => {
                const colonIndex = line.indexOf(':');
                if (colonIndex > -1) {
                    const key = line.substring(0, colonIndex).trim();
                    const value = line.substring(colonIndex + 1).trim();
                    structure[key] = value;
                }
            });
            
            return structure;
        }

        // í”„ë¡¬í”„íŠ¸ í–¥ìƒ í•¨ìˆ˜
        function enhancePrompt(text) {
            // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ì§€ í™•ì¸
            if (text.includes(':') && text.includes(';')) {
                return text; // ì´ë¯¸ êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ë°˜í™˜
            }
            
            // ê¸°ë³¸ í–¥ìƒ í‚¤ì›Œë“œ
            const enhancements = {
                quality: 'highly detailed, 4k, professional',
                style: 'cinematic lighting, photorealistic',
                camera: 'rule of thirds composition',
            };

            let enhanced = text;
            
            // í’ˆì§ˆ ê´€ë ¨ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ì¶”ê°€
            if (!text.toLowerCase().includes('detailed') && !text.toLowerCase().includes('quality')) {
                enhanced += ', ' + enhancements.quality;
            }

            return enhanced;
        }

        // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function structureToText(structure) {
            let text = '';
            const params = structure['PARAMETERS'] || '';
            const keys = Object.keys(structure).filter(key => key !== 'PARAMETERS');
            
            keys.forEach((key, index) => {
                if (structure[key]) { // ê°’ì´ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
                    text += `${key}: ${structure[key]}`;
                    if (index < keys.length - 1) {
                        text += '; ';
                    }
                }
            });
            
            if (params) {
                text += ' ' + params;
            }
            
            return text;
        }

        // ì¹´ë“œ ìƒì„± í•¨ìˆ˜
        function createPromptCards(structure) {
            promptCardsGrid.innerHTML = '';
            
            // PARAMETERSë¥¼ ì œì™¸í•œ í‚¤ë“¤ì„ ë¨¼ì € ì²˜ë¦¬
            const keys = Object.keys(structure).filter(key => key !== 'PARAMETERS');
            
            // PARAMETERSê°€ ìˆìœ¼ë©´ ë§ˆì§€ë§‰ì— ì¶”ê°€
            if (structure.hasOwnProperty('PARAMETERS')) {
                keys.push('PARAMETERS');
            }
            
            keys.forEach(key => {
                const card = document.createElement('div');
                card.className = 'prompt-card';
                card.dataset.key = key;
                
                card.innerHTML = `
                    <div class="prompt-card-header">
                        <div class="prompt-card-title">${key}</div>
                        <button class="prompt-card-edit-btn" onclick="editCard('${key}')">âœï¸</button>
                    </div>
                    <div class="prompt-card-content">${structure[key]}</div>
                    <textarea class="prompt-card-input" data-key="${key}" onkeydown="handleCardKeydown(event, '${key}')">${structure[key]}</textarea>
                    <div class="prompt-card-actions">
                        <button class="prompt-card-btn prompt-card-save" onclick="saveCard('${key}')">ì €ì¥</button>
                        <button class="prompt-card-btn prompt-card-cancel" onclick="cancelCard('${key}')">ì·¨ì†Œ</button>
                    </div>
                `;
                
                promptCardsGrid.appendChild(card);
            });
            
            promptCardsSection.style.display = 'block';
        }

        // ì¹´ë“œ í¸ì§‘ í•¨ìˆ˜
        function editCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            card.classList.add('editing');
            const input = card.querySelector('.prompt-card-input');
            input.focus();
            input.setSelectionRange(input.value.length, input.value.length);
        }

        // ì¹´ë“œ ì €ì¥ í•¨ìˆ˜
        function saveCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            const input = card.querySelector('.prompt-card-input');
            const content = card.querySelector('.prompt-card-content');
            
            promptData.structuredPrompt[key] = input.value;
            content.textContent = input.value;
            card.classList.remove('editing');
            
            // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updatePromptPreview();
            saveToLocalStorage();
        }

        // ì¹´ë“œ ì·¨ì†Œ í•¨ìˆ˜
        function cancelCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            const input = card.querySelector('.prompt-card-input');
            
            input.value = promptData.structuredPrompt[key];
            card.classList.remove('editing');
        }

        // í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        function displayPrompt(prompt) {
            outputText.textContent = prompt;
            outputSection.classList.add('active');
            
            // ìŠ¤í¬ë¡¤
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // í”„ë¡¬í”„íŠ¸ ë³µì‚¬
        copyPromptBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(outputText.textContent)
                .then(() => {
                    showToast('í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch(() => {
                    showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
        });

        // AI ì—°ë™ ë²„íŠ¼ (ë°ëª¨)
        aiConnectBtn.addEventListener('click', () => {
            showToast('AI ì—°ë™ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        });

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'toast show';
            
            if (type === 'error') {
                toast.style.background = 'rgba(239, 68, 68, 0.9)';
            } else if (type === 'info') {
                toast.style.background = 'rgba(59, 130, 246, 0.9)';
            } else {
                toast.style.background = 'rgba(16, 185, 129, 0.9)';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        function saveToLocalStorage() {
            localStorage.setItem('imagePromptData', JSON.stringify(promptData));
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('imagePromptData');
            if (saved) {
                promptData = JSON.parse(saved);
                
                // í…ìŠ¤íŠ¸ ë³µì›
                if (promptData.textInput) {
                    textInput.value = promptData.textInput;
                }
                
                // ì´ë¯¸ì§€ ë³µì›
                if (promptData.imagePreview) {
                    displayImagePreview(promptData.imagePreview);
                }
            }
        }

        // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePromptPreview() {
            const text = textInput.value.trim();
            
            if (!text && !promptData.imageFile && Object.keys(promptData.structuredPrompt).length === 0) {
                promptPreview.innerHTML = '<p class="preview-placeholder">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>';
                promptPreview.classList.remove('has-content');
                promptCardsSection.style.display = 'none';
                return;
            }

            let previewText = '';
            
            // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
            if (Object.keys(promptData.structuredPrompt).length > 0) {
                previewText = structureToText(promptData.structuredPrompt);
            } else if (text) {
                // í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸°
                previewText = enhancePrompt(text);
                
                // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ì§€ í™•ì¸í•˜ê³  íŒŒì‹±
                if (text.includes(':') && text.includes(';')) {
                    promptData.structuredPrompt = parsePrompt(text);
                    createPromptCards(promptData.structuredPrompt);
                } else {
                    promptCardsSection.style.display = 'none';
                }
            }
            
            // ì´ë¯¸ì§€ ì°¸ì¡°ëŠ” êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¼ ë•ŒëŠ” ì¶”ê°€í•˜ì§€ ì•ŠìŒ
            if (promptData.imageFile && Object.keys(promptData.structuredPrompt).length === 0) {
                if (previewText) {
                    previewText += '\n\n[ì´ë¯¸ì§€ ì°¸ì¡° í¬í•¨]\n';
                }
                previewText += 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤íƒ€ì¼ê³¼ êµ¬ì„±';
            }

            promptPreview.textContent = previewText;
            promptPreview.classList.add('has-content');
        }

        // í…ìŠ¤íŠ¸ ì…ë ¥ ì €ì¥ ë° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        textInput.addEventListener('input', () => {
            promptData.textInput = textInput.value;
            saveToLocalStorage();
            updatePromptPreview();
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë³µì›
        window.addEventListener('load', () => {
            loadFromLocalStorage();
            
            // localStorageì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ì„¤ì •
            if (!promptData.textInput && !localStorage.getItem('imagePromptData')) {
                const examplePrompt = `STYLE: 3D animation, Pixar/Disney style render; MEDIUM: CGI 3D animation; CAMERA: wide shot, eye level, professional studio scene; SUBJECT: stick figure character relaxing in director's chair, wearing oversized sunglasses holding whiskey glass, feet up on ottoman, confident relaxed pose; CHARACTER: simple stick figure with round head, thin black line body and limbs, comically oversized designer sunglasses, minimalist yet expressive, wearing suggested white shirt collar and dark pants through simple lines; FURNITURE: plush brown leather director's chair with rounded arms, matching ottoman footrest, luxurious vintage style; PROPS: crystal whiskey glass in stick hand, professional film cameras on tripods, C-stands with lights, reflectors, boom mics, cables on floor; AI ROBOTS: multiple cute robot assistants busily working around studio, one adjusting camera angle, another holding reflector, one operating boom mic, small wheeled robot managing cables, drone robot adjusting overhead light, all with glowing LED eyes and metallic finish; LIGHTING: dramatic studio lighting setup, warm key lights creating amber glow, cool blue fill lights for contrast, multiple light sources visible including softboxes and LED panels, professional photography setup; ENVIRONMENT: professional film studio with visible ceiling grid, white cyc wall, equipment cases, monitors showing footage, busy production atmosphere; ATMOSPHERE: humorous contrast between simple stick figure star and high-tech AI crew, behind-the-scenes movie production vibe, warm and cool color contrast; QUALITY: highly detailed 3D render, professional lighting, cinematic composition --ar 16:9 --v 6`;
                
                textInput.value = examplePrompt;
                promptData.textInput = examplePrompt;
            }
            
            // í…ìŠ¤íŠ¸ ì…ë ¥ì°½ì— ê¸°ë³¸ê°’ì´ ìˆìœ¼ë©´ promptDataì— ì €ì¥
            if (textInput.value.trim()) {
                promptData.textInput = textInput.value.trim();
                
                // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ ê²½ìš° ìë™ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ ì¹´ë“œ ìƒì„±
                const text = textInput.value.trim();
                if (text.includes(':') && text.includes(';')) {
                    promptData.structuredPrompt = parsePrompt(text);
                    createPromptCards(promptData.structuredPrompt);
                }
            }
            
            updatePromptPreview();
        });

        // ì¹´ë“œ ì…ë ¥ì°½ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleCardKeydown(event, key) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                saveCard(key);
            } else if (event.key === 'Escape') {
                event.preventDefault();
                cancelCard(key);
            }
        }

        // í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function importPromptFromPreview() {
            const previewText = promptPreview.textContent;
            
            if (!previewText || previewText.includes('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜')) {
                showToast('ê°€ì ¸ì˜¬ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ê°€ ì•„ë‹Œ ê²½ìš° ê¸°ë³¸ êµ¬ì¡°ë¡œ ë³€í™˜
            if (!previewText.includes(':') || !previewText.includes(';')) {
                // ê¸°ë³¸ êµ¬ì¡° í…œí”Œë¦¿
                const defaultStructure = {
                    'STYLE': '',
                    'MEDIUM': '',
                    'CAMERA': '',
                    'SUBJECT': '',
                    'CHARACTER': '',
                    'FURNITURE': '',
                    'PROPS': '',
                    'AI ROBOTS': '',
                    'LIGHTING': '',
                    'ENVIRONMENT': '',
                    'ATMOSPHERE': '',
                    'QUALITY': '',
                    'PARAMETERS': ''
                };
                
                // ê°„ë‹¨í•œ í”„ë¡¬í”„íŠ¸ëŠ” SUBJECTì— ë„£ê¸°
                defaultStructure['SUBJECT'] = previewText.replace(/\[ì´ë¯¸ì§€ ì°¸ì¡° í¬í•¨\][\s\S]*/, '').trim();
                
                promptData.structuredPrompt = defaultStructure;
                createPromptCards(defaultStructure);
                promptCardsSection.style.display = 'block';
                showToast('í”„ë¡¬í”„íŠ¸ë¥¼ ê¸°ë³¸ êµ¬ì¡°ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ê° í•­ëª©ì„ í¸ì§‘í•´ì£¼ì„¸ìš”.', 'success');
            } else {
                // ì´ë¯¸ êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ ê²½ìš° íŒŒì‹±
                const parsed = parsePrompt(previewText);
                
                // ê¸°ë³¸ êµ¬ì¡° í‚¤ë“¤
                const defaultKeys = ['STYLE', 'MEDIUM', 'CAMERA', 'SUBJECT', 'CHARACTER', 
                                   'FURNITURE', 'PROPS', 'AI ROBOTS', 'LIGHTING', 
                                   'ENVIRONMENT', 'ATMOSPHERE', 'QUALITY', 'PARAMETERS'];
                
                // ê¸°ë³¸ êµ¬ì¡°ì— ë§ì¶°ì„œ ì •ë ¬
                const structuredData = {};
                defaultKeys.forEach(key => {
                    structuredData[key] = parsed[key] || '';
                });
                
                // ê¸°ë³¸ í‚¤ì— ì—†ëŠ” ì¶”ê°€ í‚¤ë“¤ë„ í¬í•¨
                Object.keys(parsed).forEach(key => {
                    if (!defaultKeys.includes(key)) {
                        structuredData[key] = parsed[key];
                    }
                });
                
                promptData.structuredPrompt = structuredData;
                createPromptCards(structuredData);
                promptCardsSection.style.display = 'block';
                showToast('í”„ë¡¬í”„íŠ¸ë¥¼ êµ¬ì¡° í¸ì§‘ê¸°ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // window ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ì¸ë¼ì¸ onclickìš©)
        window.removeImage = removeImage;
        window.editCard = editCard;
        window.saveCard = saveCard;
        window.cancelCard = cancelCard;
        window.importPromptFromPreview = importPromptFromPreview;
        window.handleCardKeydown = handleCardKeydown;
    </script>
</body>
</html>