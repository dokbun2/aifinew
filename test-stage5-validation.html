<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage 5 v6.0 ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .test-title {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 10px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .warning {
            background: #fff3e0;
            color: #e65100;
            border: 1px solid #ff9800;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        .json-input {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        .output-log {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Stage 5 v6.0 ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ“ Stage 5 v6.0 JSON ë°ì´í„° ì…ë ¥</div>
            <textarea id="jsonInput" class="json-input" placeholder="Stage 5 v6.0 JSON ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            <button onclick="loadTestData()">ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ</button>
            <button onclick="validateData()">ë°ì´í„° ê²€ì¦ ì‹¤í–‰</button>
            <button onclick="clearAll()">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“Š ê²€ì¦ ê²°ê³¼</div>
            <div id="validationResults" class="output-log">ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ”„ ë³€í™˜ëœ ë°ì´í„° êµ¬ì¡°</div>
            <div id="convertedData" class="output-log">ë³€í™˜ëœ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        // Stage 5 v6.0 ìƒ˜í”Œ ë°ì´í„°
        const sampleData = {
            "stage": 5,
            "version": "6.0",
            "project_type": "CF",
            "film_metadata": {
                "title": "ì €ë… ë©”ë‰´ ì„¸ê³„ ì •ìƒ íšŒë‹´",
                "genre": "Comedy",
                "director": "Director Name",
                "duration": "01:00"
            },
            "breakdown_data": {
                "sequences": [
                    {
                        "sequence_id": "SEQ1",
                        "name": "ì €ë… ë©”ë‰´ ì„¸ê³„ ì •ìƒ íšŒë‹´",
                        "description": "ê°êµ­ ì •ìƒë“¤ì´ ì €ë… ë©”ë‰´ë¥¼ ë‘ê³  íšŒë‹´í•˜ëŠ” ì‹œí€€ìŠ¤"
                    }
                ],
                "scenes": [
                    {
                        "scene_id": "S01",
                        "sequence_id": "SEQ1",
                        "title": "ì •ìƒ íšŒë‹´ì¥",
                        "description": "ê°êµ­ ì •ìƒë“¤ì´ ëª¨ì—¬ ì €ë… ë©”ë‰´ë¥¼ ë…¼ì˜"
                    }
                ],
                "shots": [
                    {
                        "shot_id": "SH001",
                        "scene_id": "S01",
                        "title": "íšŒë‹´ì¥ ì „ê²½",
                        "description": "ì •ìƒë“¤ì´ ëª¨ì¸ íšŒë‹´ì¥ì˜ ì „ì²´ ëª¨ìŠµ"
                    },
                    {
                        "shot_id": "SH002",
                        "scene_id": "S01",
                        "title": "ê¹€ì¹˜ ì œì•ˆ",
                        "description": "í•œêµ­ ëŒ€í‘œê°€ ê¹€ì¹˜ë¥¼ ì œì•ˆí•˜ëŠ” ì¥ë©´"
                    },
                    {
                        "shot_id": "SH003",
                        "scene_id": "S01",
                        "title": "í”¼ì ì œì•ˆ",
                        "description": "ì´íƒˆë¦¬ì•„ ëŒ€í‘œê°€ í”¼ìë¥¼ ì œì•ˆí•˜ëŠ” ì¥ë©´"
                    },
                    {
                        "shot_id": "SH004",
                        "scene_id": "S01",
                        "title": "ìŠ¤ì‹œ ì œì•ˆ",
                        "description": "ì¼ë³¸ ëŒ€í‘œê°€ ìŠ¤ì‹œë¥¼ ì œì•ˆí•˜ëŠ” ì¥ë©´"
                    },
                    {
                        "shot_id": "SH005",
                        "scene_id": "S01",
                        "title": "ë…¼ìŸ ì¥ë©´",
                        "description": "ê°êµ­ ëŒ€í‘œë“¤ì´ ì—´ë¤ ë…¼ìŸì„ ë²Œì´ëŠ” ì¥ë©´"
                    },
                    {
                        "shot_id": "SH006",
                        "scene_id": "S01",
                        "title": "í•©ì˜ ë„ë‹¬",
                        "description": "ê²°êµ­ ëª¨ë‘ê°€ ë§Œì¡±í•˜ëŠ” ë©”ë‰´ë¡œ í•©ì˜"
                    },
                    {
                        "shot_id": "SH007",
                        "scene_id": "S01",
                        "title": "ë§Œì°¬ ì¥ë©´",
                        "description": "í•©ì˜ëœ ë©”ë‰´ë¡œ ë§Œì°¬ì„ ì¦ê¸°ëŠ” ì¥ë©´"
                    }
                ]
            }
        };

        function loadTestData() {
            document.getElementById('jsonInput').value = JSON.stringify(sampleData, null, 2);
            log('ìƒ˜í”Œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function validateData() {
            const input = document.getElementById('jsonInput').value;
            if (!input) {
                log('JSON ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                const data = JSON.parse(input);
                log('=== ë°ì´í„° ê²€ì¦ ì‹œì‘ ===', 'info');
                
                // 1. ê¸°ë³¸ êµ¬ì¡° ê²€ì¦
                log('\n1. ê¸°ë³¸ êµ¬ì¡° ê²€ì¦', 'info');
                if (data.stage === 5 && data.version === "6.0") {
                    log('âœ… Stage 5 v6.0 í˜•ì‹ í™•ì¸', 'success');
                } else {
                    log('âŒ Stage 5 v6.0 í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', 'error');
                    return;
                }

                // 2. ë°ì´í„° ë³€í™˜ ì‹œë®¬ë ˆì´ì…˜
                log('\n2. ë°ì´í„° ë³€í™˜ í”„ë¡œì„¸ìŠ¤', 'info');
                const converted = convertStage5V6Format(data);
                
                // 3. ì •í•©ì„± ê²€ì¦
                log('\n3. ë°ì´í„° ì •í•©ì„± ê²€ì¦', 'info');
                const validation = validateDataIntegrity(converted);
                
                // 4. ê²°ê³¼ í‘œì‹œ
                displayConvertedData(converted);
                
            } catch (error) {
                log(`ì˜¤ë¥˜: ${error.message}`, 'error');
                console.error(error);
            }
        }

        function convertStage5V6Format(data) {
            const result = JSON.parse(JSON.stringify(data)); // Deep copy
            
            // sequence_id â†’ id ë³€í™˜
            if (result.breakdown_data.sequences) {
                result.breakdown_data.sequences = result.breakdown_data.sequences.map(seq => {
                    if (seq.sequence_id && !seq.id) {
                        log(`ì‹œí€€ìŠ¤ ID ì •ê·œí™”: sequence_id(${seq.sequence_id}) â†’ id(${seq.sequence_id})`, 'warning');
                        seq.id = seq.sequence_id;
                        delete seq.sequence_id;
                    }
                    return seq;
                });
            }
            
            // scene_id â†’ id ë³€í™˜
            if (result.breakdown_data.scenes) {
                result.breakdown_data.scenes = result.breakdown_data.scenes.map(scene => {
                    if (scene.scene_id && !scene.id) {
                        log(`ì”¬ ID ì •ê·œí™”: scene_id(${scene.scene_id}) â†’ id(${scene.scene_id})`, 'warning');
                        scene.id = scene.scene_id;
                        delete scene.scene_id;
                    }
                    return scene;
                });
            }
            
            // shot_id â†’ id ë³€í™˜
            if (result.breakdown_data.shots) {
                result.breakdown_data.shots = result.breakdown_data.shots.map(shot => {
                    if (shot.shot_id && !shot.id) {
                        log(`ìƒ· ID ì •ê·œí™”: shot_id(${shot.shot_id}) â†’ id(${shot.shot_id})`, 'warning');
                        shot.id = shot.shot_id;
                        delete shot.shot_id;
                    }
                    return shot;
                });
            }
            
            return result;
        }

        function validateDataIntegrity(data) {
            const bd = data.breakdown_data;
            const errors = [];
            const warnings = [];
            
            // ì¤‘ë³µ ê²€ì‚¬
            const sequenceIds = new Set();
            const sceneIds = new Set();
            const shotIds = new Set();
            
            // ì‹œí€€ìŠ¤ ê²€ì¦
            bd.sequences.forEach(seq => {
                if (sequenceIds.has(seq.id)) {
                    errors.push(`ì¤‘ë³µ ì‹œí€€ìŠ¤ ID: ${seq.id}`);
                }
                sequenceIds.add(seq.id);
            });
            
            // ì”¬ ê²€ì¦
            bd.scenes.forEach(scene => {
                if (sceneIds.has(scene.id)) {
                    errors.push(`ì¤‘ë³µ ì”¬ ID: ${scene.id}`);
                }
                sceneIds.add(scene.id);
                
                if (!sequenceIds.has(scene.sequence_id)) {
                    errors.push(`ì”¬ ${scene.id}ì˜ sequence_id(${scene.sequence_id})ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ`);
                }
            });
            
            // ìƒ· ê²€ì¦
            bd.shots.forEach(shot => {
                if (shotIds.has(shot.id)) {
                    errors.push(`ì¤‘ë³µ ìƒ· ID: ${shot.id}`);
                }
                shotIds.add(shot.id);
                
                if (!sceneIds.has(shot.scene_id)) {
                    errors.push(`ìƒ· ${shot.id}ì˜ scene_id(${shot.scene_id})ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ`);
                }
            });
            
            // ê²°ê³¼ ì¶œë ¥
            if (errors.length > 0) {
                errors.forEach(err => log(`âŒ ${err}`, 'error'));
            } else {
                log('âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦ í†µê³¼', 'success');
            }
            
            // í†µê³„ ì¶œë ¥
            log(`\nğŸ“Š ë°ì´í„° í†µê³„:
- ì‹œí€€ìŠ¤: ${bd.sequences.length}ê°œ
- ì”¬: ${bd.scenes.length}ê°œ  
- ìƒ·: ${bd.shots.length}ê°œ`, 'info');
            
            return {errors, warnings};
        }

        function displayConvertedData(data) {
            const output = document.getElementById('convertedData');
            const display = {
                sequences: data.breakdown_data.sequences.map(s => ({
                    id: s.id,
                    name: s.name,
                    description: s.description
                })),
                scenes: data.breakdown_data.scenes.map(s => ({
                    id: s.id,
                    sequence_id: s.sequence_id,
                    title: s.title
                })),
                shots: data.breakdown_data.shots.map(s => ({
                    id: s.id,
                    scene_id: s.scene_id,
                    title: s.title
                }))
            };
            
            output.textContent = JSON.stringify(display, null, 2);
        }

        function log(message, type = 'info') {
            const output = document.getElementById('validationResults');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearAll() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('validationResults').textContent = 'ê²€ì¦ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('convertedData').textContent = 'ë³€í™˜ëœ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒ˜í”Œ ë°ì´í„° ìë™ ë¡œë“œ
        window.onload = () => {
            loadTestData();
        };
    </script>
</body>
</html>